**04 Août**
- [ ] ESL
    - [ ] Dashboard : Créer une modale pour l'affichage des ESLs associées au clic de la matcard
        - [x] nouveau html
        ```
        <div class="container mx-auto p-4">
            <div class="bg-white shadow-md rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4">ESLs associées</h2>
                <div class="overflow-x-auto">
                <div class="min-w-full">
                    <table class="min-w-full bg-white">
                    <thead>
                        <tr class="w-full bg-gray-200">
                        <th class="px-4 py-2 text-left text-gray-600">ESL</th>
                        <th class="px-4 py-2 text-left text-gray-600">Width</th>
                        <th class="px-4 py-2 text-left text-gray-600">Height</th>
                        <th class="px-4 py-2 text-left text-gray-600">Option</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let esl of eslsWithStoreArticle" class="border-b hover:bg-gray-100">
                        <td class="px-4 py-2">{{ esl.id_esl }}</td>
                        <td class="px-4 py-2">{{ esl.width }}</td>
                        <td class="px-4 py-2">{{ esl.height }}</td>
                        <td class="px-4 py-2">
                            <button
                            class="mt-2 bg-green-500 border-4 text-white rounded-sm hover:bg-green-600"
                            (click)="blinkEsl(esl.id_esl, encodeColor('#00FF00'))"
                            >
                            Clignoter
                            </button>
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                </div>
            </div>
        </div>
        ```
        - [x] nouveau component
        ```
        import { Component, EventEmitter, Output } from '@angular/core';
        import { EslService } from '../services/esl.service';
        import { CommonModule } from '@angular/common';
        import {MatSnackBar} from '@angular/material/snack-bar';

        @Component({
        selector: 'app-assigned-esls-modal',
        standalone: true,
        imports: [CommonModule],
        templateUrl: './assigned-esls-modal.component.html',
        styleUrls: ['./assigned-esls-modal.component.scss']
        })
        export class AssignedEslsModalComponent {
        eslsWithStoreArticle: any[] = [];
        @Output() closeModal = new EventEmitter<void>();

        constructor(
            private eslService: EslService,
            private snackBar: MatSnackBar
        ) {
            this.fetchEslsWithStoreArticle();
        }

        fetchEslsWithStoreArticle(): void {
            this.eslService.getEslsActive().subscribe((data) => {
                if (Array.isArray(data)) {
                this.eslsWithStoreArticle = data;
                } else {
                console.error(data);
                }
            }, (error) => {
                console.error(error);
            });
        }

        onClose(): void {
            this.closeModal.emit();
        }
        
        blinkEsl(id_esl: string, color: string) {
            this.eslService.blinkEsl(id_esl, color).subscribe({
            next: async () => {
                console.log(`L\'ESL à l\'ID ${id_esl} clignote avec la couleur :  ${color}`);
                this.snackBar.open(`L\'ESL à l\'ID ${id_esl} clignote avec la couleur :  ${color}`, 'Close', {
                duration: 2000,
                });
            },
            error: async (error) => {
                console.error(error);
            },
            });
        }
        encodeColor(color: string): string {
            return encodeURIComponent(color);
        }
        }
        ```
        - [x] nouveau scss
        ```
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
        }
        ```

Pour l'adaptation bowtz-backend, utiliser python, soit flask, soit fastApi pour la documentation automatique

- [ ] ESL
    - [ ] ESL-417 ESL Management : ajouter un retour immédiat à tous les boutons pour indiquer le clic
        - [ ] Bouton désactiver
            - [ ] Changer le retour pour un message snackbar en françaic
            ```
            onDisableSubmit(): void {
                if (this.idEsl && this.width > 0 && this.height > 0) {
                    const barcodeImage = this.disableTemplateService.generateImageString(this.idEsl, this.width, this.height);
                    console.log('(1)barcodeImage : ', barcodeImage);

                    const base64String = barcodeImage.split(',')[1];
                    console.log('(2)base64String : ', base64String);

                    const payload: UpdatePictureEslDto = { picture: base64String };

                    this.eslService.updateOnEslAndDisable(this.idEsl, payload).subscribe({
                    next: () => {
                        this.snackBar.open('ESL désactivée avec succès !', 'Fermer', {
                        duration: 3000,
                        panelClass: ['snackbar-success']
                        });
                    },
                    error: () => {
                        this.snackBar.open('Erreur lors de la désactivation de l\'ESL.', 'Fermer', {
                        duration: 4000,
                        panelClass: ['snackbar-error']
                        });
                    }
                    });
                } else {
                    this.snackBar.open('Paramètres ESL invalides, vérifiez l\'ID et les dimensions.', 'Fermer', {
                    duration: 4000,
                    panelClass: ['snackbar-warning']
                    });
                }
            }
            ```
        - [ ] Bouton rafraîchir
            - [ ] Changer le retour pour un message snackbar en françaic
            ```
            forceRefresh() {
                if (this.idEsl) {
                this.storeArticleService.getStoreArticleAndforceRefresh(this.idEsl).subscribe({
                    next: (response) => {
                    this.snackBar.open('Rafraîchissement effectué avec succès!', 'Fermer', {
                        duration: 2000,
                    });
                    console.log('Rafraîchissement effectué avec succès:', response);
                    },
                    error: (err) => {
                    this.snackBar.open('Echec du rafraîchissement: ', 'Fermer', {
                        duration: 2000,
                    });
                    console.error('Echec du rafraîchissement:', err);
                    }
                });
                } else {
                this.snackBar.open('Aucun ESLID', 'Fermer', {
                    duration: 2000,
                });
                }
            }
            ```
    - [ ] ESL-416 ESL Management : l'aperçu doit afficher un message d'erreur si erreur utilisateur au lieu d'un aperçu blanc
        - [x] Modif de l'openDialogPreview() :
        ```
        async openDialogPreview() {
            try {
            const template = await this.templateService.getTemplateByEslId(this.idEsl).toPromise();

            if (!template || Object.keys(template).length === 0) {
                this.snackBar.open('Aucun template associé à cette ESL.', 'Fermer', {
                duration: 3000,
                panelClass: ['snackbar-error']
                });
                return;
            }

            const imagePreview = await this.previewCanvasImage();

            this.dialog.open(PreviewTemplateModalComponent, {
                width: this.width + 20 + 'px',
                height: this.height + 20 + 'px',
                data: imagePreview
            });

            } catch (error) {
            console.error('Erreur lors de la récupération du template :', error);
            this.snackBar.open('Erreur lors du chargement du template : pas de template associé', 'Fermer', {
                duration: 3000,
                panelClass: ['snackbar-error']
            });
            }
        }
        ```
    - [ ] ESL-418 ESL Management : ajouter un bouton de dissociation dans l'interface
        - [ ] html
        ```
        <button class="bg-yellow-500 hover:bg-yellow-700 h-16 text-white grid grid-cols-2 pl-[20%] pr-[34%]  font-bold py-3 pt-4 rounded" (click)="onDissociateSubmit($event)">


            <svg xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 -960 960 960" width="35px" fill="#FFFFFF" >
                <path d="M742-120 619-243l58-58q22-22 32.5-49.5T720-407q0-14-2.5-27.5T708-461l47-47q11 20 17 42t6 45q0 46-17.5 86T711-268l57 58-26 26Zm-124-124-58-58q-23-20-38.5-47T506-407h67q4 15 12 29.5t20 26.5l57-57-340-340-57 57q-22 22-32.5 49.5T280-553q0 14 2.5 27.5T292-499l-47 47q-11-20-17-42t-6-45q0-46 17.5-86T249-692l-57-58 26-26 624 624-26 26Zm-94-94-300-300q-5 10-7.5 20.5T214-553q0 38 27 65t65 27q10 0 20.5-2.5T347-476l56 56q-20 11-42 17t-45 6q-79 0-134-55T128-586q0-23 4.5-45.5T145-676l-59-60 57-57 623 623-57 57-59-58q-20 11-42 17t-45 6q-23 0-45.5-4.5T524-338Zm-19-173Zm-67-67Zm53-50Zm-67-67Zm53-50Z"/>
            </svg>
            <p class=" text-xl">Dissocier</p>

        </button>
        ```
    - [ ] ESL-421 Création de template : Ajustements
        - harmoniser la position de toolbar à la selection de l'objet canvas
            - suppression du calcul dynamique avec calcul de zoom mon cu l :
            ```
            /canvasRect.left + (selected.left * zoom) + (selected.width * zoom / 2) - (toolbarEl.offsetWidth / 2);
            ```
            - remplacement par une valeur fixe : 
            ```
            const left = window.innerWidth * 0.15;
            ```
            dans : 
            ```
            if (this.toolbar && selected) {
                const toolbarEl = this.toolbar.nativeElement;
                const canvasRect = this.canvas.getElement().getBoundingClientRect();

                const left = window.innerWidth * 0.15; 
                ...
            ```
        - déselectionner l'objet canvas en cliquant en dehors :
        ```
        // Ajouter un éco   uteur d'événement pour les clics sur le document
        document.addEventListener('click', (event) => {
            const canvasElement = document.getElementById('canvas');
            const toolbarElement = this.toolbar?.nativeElement;

            // Vérifier si le clic a eu lieu en dehors du canvas et de la barre d'outils
            if (canvasElement && !canvasElement.contains(event.target as Node) &&
                toolbarElement && !toolbarElement.contains(event.target as Node)) {
            this.canvas.discardActiveObject();
            this.canvas.renderAll();
            this.hideToolbar();
            }
        });
        ```
        ne fonctionne pas malgré la condition car déselectionne tout le temps.
        trouver autre chose.