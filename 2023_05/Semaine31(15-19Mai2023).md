**15 Mai**
- [ ] Poursuite Predict
    - [x] MàJ du fichier excel sur les tests
    - [ ] Up du coverage
        - [ ] Back-end
            - [ ] Services
                - [ ] Test du service mailing
                - [ ] Test du service stores
                    - [ ] Résolution du fail :
                    ```
                    ● StoresService › createStore › should create a new store and assign the gateway
                                                  
                    HttpException: DataSource is not set for this entity.  
                    ```
                    - [x] Résolution du fail :
                    ```
                    ● StoresService › findAllPaginate › should find all stores with pagination and filter        
                    TypeError: queryBuilder.limit is not a function
                    ```
                    ajout à la déclaration de queryBuilder de : 
                    ```
                    limit: jest.fn().mockReturnThis(),
                    where: jest.fn().mockReturnThis(),
                    ```            
                    qui débouche sur :
                    - [x] Résolution du fail :
                    ``` 
                    ● StoresService › findAllPaginate › should find all stores with pagination and filter    
                                                  
                    TypeError: queryBuilder.limit(...).offset is not a function 
                    ```
                    le queryBuilder updated avec toutes les méthodes est : 
                    ```
                    const queryBuilder = {
                        leftJoinAndSelect: jest.fn().mockReturnThis(),
                        limit: jest.fn().mockReturnThis(),
                        where: jest.fn().mockReturnThis(),
                        andWhere: jest.fn().mockReturnThis(),
                        orWhere: jest.fn().mockReturnThis(),
                        getMany: jest.fn().mockResolvedValue([]),
                        cache: jest.fn().mockReturnThis(),
                        clone: jest.fn().mockReturnThis(),
                        skip: jest.fn().mockReturnThis(),
                        take: jest.fn().mockReturnThis(),
                        orderBy: jest.fn().mockReturnThis(),
                        offset: jest.fn().mockReturnThis()
                    };
                    ```
                    - [ ] Résolution du fail :
                    ```
                    ● StoresService › createStore › should create a new store and assign the gateway
                                                  
                    TypeError: Cannot read properties of undefined (reading 'createQueryBuilder') 
                    ```
                - [ ] Test du service users
                    - [ ] Résolution du fail :
                    ```
                    ● users › addUserWithRole › should throw HttpException if an error occurs

                    TypeError: Cannot read properties of undefined (reading 'env')

                    15 |     kcAdminClient = new KeycloakAdminClient();
                    16 |     await kcAdminClient.auth({
                    > 17 |       clientId: process.env.KC_CLIENT,
                    ```
                    Réponse de gpt : 
                    ```
                    The error message suggests that the process.env object is undefined within the test environment. This issue commonly occurs because the test environment doesn't have access to the actual environment variables defined in your .env file.

                    To resolve this, you can use a library like dotenv to load the environment variables from the .env file specifically for your tests.

                    First, install dotenv as a development dependency:

                    bash
                    Copy code
                    npm install dotenv --save-dev
                    Then, create a setup file specifically for your tests, e.g., test-setup.js, and place it in the same directory as your test files. In this file, load the environment variables using dotenv:
                    ```
            - [ ] Statements
            - [ ] Functions
    - [ ] Update du fichier excel avec les tests à venir sur les controller


**16 Mai**
- [ ] Poursuite Predict
    - [ ] MàJ du fichier excel sur les tests
    - [ ] Up du coverage
        - [ ] Back-end
            - [ ] Services
                - [ ] Test du service mailing
                - [ ] Test du service stores
                    - [ ] Résolution du fail :
                    ```
                    ● StoresService › createStore › should create a new store and assign the gateway
                                                  
                    HttpException: DataSource is not set for this entity.  
                    ```
                    - [ ] Résolution du fail :
                    ```
                    ● StoresService › createStore › should create a new store and assign the gateway
                                                  
                    TypeError: Cannot read properties of undefined (reading 'createQueryBuilder') 
                    ```
                - [ ] Test du service users
                    - [ ] Résolution du fail :
                    ```
                    ● users › addUserWithRole › should throw HttpException if an error occurs

                    TypeError: Cannot read properties of undefined (reading 'env')

                    15 |     kcAdminClient = new KeycloakAdminClient();
                    16 |     await kcAdminClient.auth({
                    > 17 |       clientId: process.env.KC_CLIENT,
                    ```
                    - [ ] Essai de setting du env via création d'un "setupFilesAfterEnv": ["./test-utils.js"]
            - [ ] Statements
            - [ ] Functions
    - [ ] Update du fichier excel avec les tests à venir sur les controller
    